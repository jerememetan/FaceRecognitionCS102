# Embedding Quality Test

This directory contains scripts to test the quality of face embeddings generated by the face recognition system.

## Available Test Scripts

### 1. EnhancedEmbeddingQualityTest.java
**Comprehensive quality analysis** that provides:
- ✅ Intra-person similarity analysis (should be >0.8)
- ✅ Inter-person similarity analysis (should be <0.4)
- ✅ Separation margin calculation
- ✅ Outlier detection
- ✅ Overall quality score (0-100)
- ✅ Detailed recommendations

### 2. EmbeddingSimilarityTest.java
**Detailed similarity analysis** using FaceEmbeddingGenerator:
- Similarity matrix between all persons
- Statistical analysis of similarities
- Uses the full FaceEmbeddingGenerator for validation

### 3. SimpleEmbeddingSimilarityTest.java
**Standalone similarity analysis** without FaceEmbeddingGenerator:
- Faster execution
- Direct embedding file analysis
- Good for quick quality checks

## How to Run

### Option 1: Batch File (Recommended)
```batch
RunEmbeddingQualityTest.bat
```

### Option 2: Manual Gradle
```batch
gradlew compileTestJava
java -cp "build/classes/java/main;build/classes/java/test;lib/*" test.EnhancedEmbeddingQualityTest
```

### Option 3: Run Other Tests
```batch
java -cp "build/classes/java/main;build/classes/java/test;lib/*" test.EmbeddingSimilarityTest
java -cp "build/classes/java/main;build/classes/java/test;lib/*" test.SimpleEmbeddingSimilarityTest
```

## Quality Metrics Explained

### Intra-person Similarity
- **Excellent**: >0.85 (same person, different images)
- **Good**: 0.75-0.85
- **Fair**: 0.60-0.75
- **Poor**: <0.60

### Inter-person Similarity
- **Excellent**: <0.30 (different persons)
- **Good**: 0.30-0.40
- **Fair**: 0.40-0.50
- **Poor**: >0.50

### Separation Margin
- **Excellent**: >0.30 (intra - inter similarity)
- **Good**: 0.20-0.30
- **Fair**: 0.10-0.20
- **Poor**: <0.10

## Interpreting Results

### Overall Score (0-100)
- **90-100 (A)**: Excellent quality, ready for production
- **75-89 (B)**: Good quality, should work well
- **60-74 (C)**: Fair quality, may have occasional issues
- **<60 (F)**: Poor quality, needs significant improvements

### Common Issues & Solutions

1. **Low intra-person similarity**
   - Cause: Poor image quality, inconsistent lighting, bad angles
   - Solution: Re-capture face data with better conditions

2. **High inter-person similarity**
   - Cause: Similar-looking people, poor face alignment
   - Solution: Ensure diverse face angles, better lighting

3. **Outliers detected**
   - Cause: Blurry images, occlusions, extreme angles
   - Solution: Remove outlier images and re-capture

4. **Insufficient data**
   - Cause: Too few images per person (<3)
   - Solution: Capture more face images per person

## File Structure Expected

```
data/
  facedata/
    PersonName1/
      image1.png
      image1.emb
      image2.png
      image2.emb
      ...
    PersonName2/
      ...
```

## Dependencies

- OpenCV 4.8.0 (opencv_java480.dll)
- Java 8 or higher
- Gradle build system